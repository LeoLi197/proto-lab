<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>IELTS 情景化学习系统</title>
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="./styles.css">
    <link rel="icon" href="../../public/favicon.ico">
</head>
<body class="ielts-theme">
    <div class="feature-container ielts-app">
        <header class="app-header">
            <a class="back-link" href="../../dashboard.html">← 返回功能中心</a>
            <div>
                <h1>IELTS 情景化学习系统</h1>
                <p>上传单词或实物照片，系统将自动提取核心词汇、生成情境故事与阅读练习，并通过 SRS 机制帮助你巩固记忆。</p>
            </div>
            <nav id="viewTabs" class="tab-nav" role="tablist">
                <button type="button" data-route="home" class="is-active" role="tab" aria-selected="true">上传中心</button>
                <button type="button" data-route="study" role="tab" aria-selected="false">学习页</button>
                <button type="button" data-route="review" role="tab" aria-selected="false">复习页</button>
            </nav>
        </header>

        <main class="app-main">
            <section id="viewHome" class="view view-active" data-view="home">
                <div class="home-grid">
                    <section class="panel upload-panel">
                        <div class="panel-header">
                            <h2>上传与生成</h2>
                            <span id="uploadStatusBadge" class="badge">待开始</span>
                        </div>
                        <p class="panel-subtitle">支持拖拽或选择上传，系统会在 2 秒内进入骨架屏生成状态。单张图片最大 10MB，仅支持 JPG / PNG。</p>
                        <div id="uploadDropzone" class="upload-dropzone" role="button" tabindex="0" aria-label="上传学习图片">
                            <div class="dropzone-icon">📤</div>
                            <p>拖拽图片到此处，或
                                <button type="button" id="pickFilesBtn">选择文件</button>
                            </p>
                            <p class="upload-tip">最多可同时上传 3 张图片，系统自动去重并生成学习会话。</p>
                        </div>
                        <input type="file" id="filePicker" accept="image/png,image/jpeg" multiple hidden>
                        <div id="uploadProgressContainer" class="progress-container" aria-live="polite">
                            <div class="progress-bar"><span id="uploadProgressFill"></span></div>
                            <span id="uploadProgressText">0%</span>
                        </div>
                        <p id="uploadError" class="error-message" role="alert"></p>
                        <div class="api-key-config">
                            <label for="geminiApiKey">Gemini API Key</label>
                            <div class="api-key-row">
                                <input type="password" id="geminiApiKey" autocomplete="off" spellcheck="false" placeholder="输入 Gemini API Key">
                                <label class="remember-key" for="rememberGeminiKey">
                                    <input type="checkbox" id="rememberGeminiKey"> 记住
                                </label>
                            </div>
                            <small class="upload-tip">密钥仅保存在本地浏览器，用于触发 Gemini 解析与生成。</small>
                        </div>
                    </section>

                    <section class="panel recent-panel">
                        <div class="panel-header">
                            <h2>最近 10 张图片</h2>
                            <span id="recentCount" class="badge">0</span>
                        </div>
                        <p class="panel-subtitle">上传后立即生成缩略图，便于快速回溯学习素材。</p>
                        <div id="recentGrid" class="recent-grid" aria-live="polite"></div>
                    </section>
                </div>
            </section>

            <section id="viewStudy" class="view" data-view="study" aria-hidden="true">
                <div class="study-layout">
                    <section class="panel image-panel">
                        <div class="panel-header">
                            <h2>原图预览</h2>
                            <div class="badge" id="assetMeta">无图像</div>
                        </div>
                        <div class="image-toolbar">
                            <div id="assetStrip" class="asset-strip" aria-label="图片列表"></div>
                            <div id="zoomControls" class="zoom-controls" aria-label="缩放控制">
                                <button type="button" data-zoom="out" aria-label="缩小">−</button>
                                <button type="button" data-zoom="reset" aria-label="重置">⟳</button>
                                <button type="button" data-zoom="in" aria-label="放大">＋</button>
                            </div>
                        </div>
                        <div class="image-viewer">
                            <div id="imageViewport" class="image-viewport">
                                <div id="imageStage" class="image-stage">
                                    <img id="studyImage" src="" alt="学习原图" hidden>
                                    <div id="bboxLayer" class="bbox-layer"></div>
                                </div>
                                <div id="imagePlaceholder" class="image-placeholder">上传后将在此显示原图与词框。</div>
                            </div>
                        </div>
                    </section>

                    <section class="panel detail-panel">
                        <div class="panel-section word-section">
                            <div class="panel-header">
                                <h2>词卡列表</h2>
                                <span id="wordCountBadge" class="badge">0</span>
                            </div>
                            <div id="wordCardList" class="word-list" aria-live="polite"></div>
                        </div>
                        <div class="panel-section reading-section">
                            <div class="panel-header">
                                <h2>阅读填空</h2>
                                <span id="readingStatus" class="badge">未生成</span>
                            </div>
                            <div id="readingQuiz" class="reading-quiz" aria-live="polite"></div>
                        </div>
                    </section>
                </div>
            </section>

            <section id="viewReview" class="view" data-view="review" aria-hidden="true">
                <section class="panel review-panel">
                    <div class="panel-header">
                        <h2>SRS 复习清单</h2>
                        <span id="reviewSummary" class="badge">今日 0 / 累积 0</span>
                    </div>
                    <p class="panel-subtitle">采用 0–5 级记忆曲线，对应复习间隔 [1d, 3d, 7d, 14d, 30d]，数据持久化于本地。</p>
                    <div id="reviewList" class="review-list" aria-live="polite"></div>
                    <p id="reviewOverflow" class="panel-note"></p>
                </section>
            </section>
        </main>
    </div>

    <script src="../../config.js"></script>
    <script src="../../auth.js"></script>
    <script src="../../models.js"></script>
    <script src="../../usage.js"></script>
    <script src="./script.js"></script>
</body>
</html>
